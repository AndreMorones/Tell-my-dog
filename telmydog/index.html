<!DOCTYPE html>
<html>
<head>
    <title>TTellMyDog</title>
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5; /* Un gris muy claro */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            color: #333;
        }

        /* Contenedor principal */
        #container {
            background-color: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        /* Título */
        h1 {
            font-size: 24px;
            margin-top: 0;
            color: #1c1e21;
        }

        /* Botón de inicio */
        #start-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 20px;
        }

        #start-button:hover {
            background-color: #0056b3;
        }

        /* Contenedor de la cámara */
        #webcam-container {
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden; /* Para que el canvas no se salga de los bordes redondeados */
            display: inline-block;
        }

        /* Contenedor de las etiquetas de predicción */
        #label-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px; /* Espacio entre las barras */
        }

        /* Estilo para cada predicción (la barra) */
        .prediction-bar {
            background-color: #e9ecef;
            border-radius: 5px;
            width: 100%;
            height: 24px;
            position: relative;
            overflow: hidden;
        }

        /* Relleno de la barra que indica la probabilidad */
        .prediction-fill {
            background-color: #28a745; /* Verde para la probabilidad */
            height: 100%;
            border-radius: 5px;
            transition: width 0.2s ease-in-out;
        }

        /* Texto dentro de la barra */
        .prediction-text {
            position: absolute;
            top: 0;
            left: 10px;
            right: 10px;
            line-height: 24px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div id="container">
        <h1>Iniciar Reconocimiento</h1>
        <button id="start-button" type="button" onclick="init()">Start</button>
        <div id="webcam-container"></div>
        <div id="label-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/Jn79FaTEV/";
        let model, webcam, labelContainer, maxPredictions;

        async function init( ) {
            // Ocultar el botón de inicio después de hacer clic
            document.getElementById("start-button").style.display = "none";

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            const flip = true;
            webcam = new tmImage.Webcam(300, 300, flip); // Aumentamos el tamaño de la cámara
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);

            document.getElementById("webcam-container").appendChild(webcam.canvas);
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                // Creamos la estructura de la barra de predicción
                const barContainer = document.createElement("div");
                barContainer.classList.add("prediction-bar");

                const fill = document.createElement("div");
                fill.classList.add("prediction-fill");

                const text = document.createElement("div");
                text.classList.add("prediction-text");

                barContainer.appendChild(fill);
                barContainer.appendChild(text);
                labelContainer.appendChild(barContainer);
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            for (let i = 0; i < maxPredictions; i++) {
                const probability = prediction[i].probability;
                const className = prediction[i].className;
                
                const bar = labelContainer.childNodes[i];
                const fill = bar.querySelector(".prediction-fill");
                const text = bar.querySelector(".prediction-text");

                // Actualizamos el ancho de la barra y el texto
                fill.style.width = (probability * 100) + "%";
                text.innerHTML = `${className}: ${(probability * 100).toFixed(0)}%`;
            }
        }
    </script>

</body>
</html>
